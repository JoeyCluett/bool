<root>

    <module name="half-adder">

        <gate type="XOR" name="xor1"/>
        <gate type="AND" name="and1"/>

        <!-- inputs can go to multiple destinations -->
        <input name="A" to="and1.A:xor1.A"/>
        <input name="B" to="and1.B:xor1.B"/>

        <!-- outputs can only have one source -->
        <output name="SUM"   from="xor1"/>
        <output name="CARRY" from="and1"/>

    </module>

    <module name="full-adder">

        <!-- instance is always a predefined module -->
        <instance type="half-adder" name="lower-adder"/>
        <instance type="half-adder" name="upper-adder"/>
        <gate     type="OR"         name="carry-or"/>

        <!-- signals must have only one source but can go to multiple dest -->
        <signal from="lower-adder.SUM"  to="upper-adder.B"/>
        
        <!-- collect all of the carry signals -->
        <signal from="lower-adder.CARRY" to="carry-or.B"/>
        <signal from="upper-adder.CARRY" to="carry-or.A"/>

        <input name="CARRY-IN" to="upper-adder.A"/>
        <input name="A"        to="lower-adder.A"/>
        <input name="B"        to="lower-adder.B"/>

        <output name="SUM"       from="upper-adder.SUM"/>
        <output name="CARRY-OUT" from="carry-or"/>

    </module>

    <module name="4-bit-adder">

        <!-- multiple instances of the same type of entity -->
        <instance type="full-adder" name="bit0"/>
        <instance type="full-adder" name="bit1"/>
        <instance type="full-adder" name="bit2"/>
        <instance type="full-adder" name="bit3"/>
        
        <!-- set all of those pesky carry bits -->
        <signal from="bit0.CARRY-OUT" to="bit1.CARRY-IN"/>
        <signal from="bit1.CARRY-OUT" to="bit2.CARRY-IN"/>
        <signal from="bit2.CARRY-OUT" to="bit3.CARRY-IN"/>

        <!-- arrays of input/output values -->
        <inputvec size="4" name="A" to="bit0.A:bit1.A:bit2.A:bit3.A"/>
        <inputvec size="4" name="B" to="bit0.B:bit1.B:bit2.B:bit3.B"/>

        <outputvec size="4" name="SUM" from="bit0.SUM:bit1.SUM:bit2.SUM:bit3.SUM"/>

        <!-- single bit carry in/out -->
        <input name="CARRY-IN" to="bit0.CARRY-IN"/>
        <output name="CARRY-OUT" from="bit3.CARRY-OUT"/>

    </module>

    <module name="8-bit-adder">

        <instance type="4-bit-adder" name="lsb"/>
        <instance type="4-bit-adder" name="msb"/>

        <signal from="lsb.CARRY-OUT" to="msb.CARRY-IN"/>

        <inputvec name="A" size="8" to="lsb.A:msb.A"/>
        <inputvec name="B" size="8" to="lsb.B:msb.B"/>

        <outputvec name="SUM" size="8" from="lsb.SUM:msb.SUM"/>

        <input name="CARRY-IN" to="lsb.CARRY-IN"/>
        <output name="CARRY-OUT" from="msb.CARRY-OUT"/>

    </module>

</root>